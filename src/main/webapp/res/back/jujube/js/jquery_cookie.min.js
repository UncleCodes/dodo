/*!
 * jQuery Cookie Plugin
 * https://github.com/carhartl/jquery-cookie
 *
 * Copyright 2011, Klaus Hartl
 * Dual licensed under the MIT or GPL Version 2 licenses.
 * http://www.opensource.org/licenses/mit-license.php
 * http://www.opensource.org/licenses/GPL-2.0
 */
;(function(g){g.cookie=function(h,b,a){if(1<arguments.length&&(!/Object/.test(Object.prototype.toString.call(b))||null===b||void 0===b)){a=g.extend({},a);if(null===b||void 0===b)a.expires=-1;if("number"===typeof a.expires){var d=a.expires,c=a.expires=new Date;c.setDate(c.getDate()+d)}b=""+b;return document.cookie=[encodeURIComponent(h),"=",a.raw?b:encodeURIComponent(b),a.expires?"; expires="+a.expires.toUTCString():"",a.path?"; path="+a.path:"",a.domain?"; domain="+a.domain:"",a.secure?"; secure": ""].join("")}for(var a=b||{},d=a.raw?function(a){return a}:decodeURIComponent,c=document.cookie.split("; "),e=0,f;f=c[e]&&c[e].split("=");e++)if(d(f[0])===h)return d(f[1]||"");return null}})(jQuery);
function changeThemeFun(themeName) {
    var $easyuiTheme = $('#easyuiTheme');
    var url = $easyuiTheme.attr('href');
    var href = url.substring(0, url.indexOf('themes')) + 'themes/' + themeName + '/easyui.css';
    $easyuiTheme.attr('href', href);

    var $iframe = $('iframe');
    if ($iframe.length > 0) {
        for ( var i = 0; i < $iframe.length; i++) {
            var ifr = $iframe[i];
            $(ifr).contents().find('#easyuiTheme').attr('href', href);
        }
    }

    $.cookie('easyuiThemeName', themeName, {
        expires : 7,path: '/'
    });
    dealIconTheme(themeName);
}

function dealIconTheme(themeName){
	$("#themeMenuItem").find(".menu-icon").remove();
	$("#"+themeName).append("<div class='menu-icon icon-ok'></div>");
}
function autoChangeTheme(){
	var themeSrc = $('#easyuiTheme').attr('href');
	themeSrc = themeSrc.substring(themeSrc.indexOf('themes')+7);
	themeSrc = themeSrc.substring(0,themeSrc.indexOf("/"));		
	var $CookieThemeName = $.cookie('easyuiThemeName',{path: '/'});
	if ($CookieThemeName) {
		if(themeSrc!=$CookieThemeName){
			changeThemeFun($CookieThemeName);
		}else{
			dealIconTheme(themeSrc);
		}
	}else{
		dealIconTheme(themeSrc);
		$.cookie('easyuiThemeName', themeSrc, {
	        expires : 7,path: '/'
	    });
	}
}